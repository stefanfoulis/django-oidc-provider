[tox]
envlist=
    docs,
    dj20-py{34,35,36,37},
    dj21-py{35,36,37},
    dj22-py{35,36,37,38,39},
    dj30-py{36,37,38,39},
    dj31-py{36,37,38,39},
    dj32-py{36,37,38,39,310},
    dj40-py{38,39,310},
    dj41-py{38,39,310,311},
    dj42-py{38,39,310,311,312},
    flake8

[testenv]
changedir=
    oidc_provider
deps =
    mock
    psycopg2-binary
    pytest
    pytest-django
    pytest-flake8
    pytest-cov
    dj20: django>=2.0,<2.1
    dj21: django>=2.1,<2.2
    dj22: django>=2.2,<3.0
    dj30: django>=3.0,<3.1
    dj31: django>=3.1,<3.2
    dj32: django>=3.2,<3.3
    dj40: django>=4.0,<4.1
    dj41: django>=4.1,<4.2
    dj42: django>=4.2,<5.0

commands =
    pytest --cov=oidc_provider {posargs}

[testenv:docs]
basepython = python3.8
changedir = docs
whitelist_externals =
    mkdir
deps =
    sphinx
    sphinx_rtd_theme
commands =
    mkdir -p _static/
    sphinx-build -v -W -b html -d {envtmpdir}/doctrees -D html_static_path="_static" . {envtmpdir}/html

[pytest]
DJANGO_SETTINGS_MODULE = oidc_provider.tests.settings
python_files = test_*.py


[testenv:flake8]
basepython = python3.8
deps =
    flake8
commands =
    flake8 . --exclude=venv/,.tox/,migrations --max-line-length 100